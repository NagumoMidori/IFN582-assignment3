{% extends "base.html" %}
{% set active_page = 'cart' %}
{% block title %}Your Cart â€” Art Lease Gallery{% endblock %}

{% block content %}
<h1 class="h3 mb-4 cart-heading">Your Cart</h1>

{% if cart.items %}
  <div class="card cart-card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover cart-table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Item</th><th>Qty</th><th>Weeks</th>
              <th class="text-end">Unit (AUD)</th>
              <th class="text-end">Line total</th><th></th>
            </tr>
          </thead>
          <tbody>
          {% for li in cart.items %}
            <tr>
              <td>
                <div class="flex gap-3 items-center cart-item__media">
                  <img src="{{ url_for('static', filename=li.artwork.image) }}" alt="{{ li.artwork.title }}" class="thumb">
                  <div>
                    <div><a href="{{ url_for('main.item_details', artwork_id=li.artwork_id) }}">{{ li.artwork.title }}</a></div>
                    <small class="status-pill">Status: {{ li.artwork.availabilityStatus }}</small>
                  </div>
                </div>
              </td>
              <td>{{ li.quantity }}</td>
              <td>{{ li.rentalDuration or 1 }}</td>
              <td class="text-end">${{ '%.2f'|format(li.artwork.pricePerWeek) }}</td>
              <td class="text-end">${{ '%.2f'|format(li.artwork.pricePerWeek * li.quantity * li.rentalDuration) }}</td>
              <td class="text-end">
                <form action="{{ url_for('main.cart_remove', item_id=li.cartItem_id) }}" method="post">
                  {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
                  <button class="btn btn-ghost" type="submit">Remove</button>
                </form>
              </td>
            </tr>
          {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="text-end fw-bold">Total</td>
              <td class="text-end fw-bold">${{ '%.2f'|format(cart.total_using_current_prices()) }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    <div class="card-footer cart-actions bg-white">
      <form action="{{ url_for('main.cart_clear') }}" method="post">
        {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
        <button class="btn btn-secondary" type="submit">Clear cart</button>
      </form>
      <a class="btn colour__button__2" href="{{ url_for('main.checkout') }}">Proceed to checkout</a>
    </div>
  </div>
{% else %}
  <p>Your cart is empty. <a href="{{ url_for('main.index') }}">Continue shopping</a>.</p>
{% endif %}
{% endblock %}
