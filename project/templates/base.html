{% set active_page = active_page|default('') %}
<!doctype html>
<html lang="en">
{% set user = session.get('user') %}
{% set role = user.get('role') if user else None %}
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/shop.svg') }}" type="image/svg+xml">
  <title>{% block title %}Art Lease Gallery{% endblock %}</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  {% block extra_head %}{% endblock %}
</head>

<body>
  <header>
    <nav class="navbar navbar-expand-md nav__colour navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="{{ url_for('main.index') }}">Art Lease Gallery</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain"
          aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navMain" class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link {% if active_page=='home' %}active{% endif %}"
                href="{{ url_for('main.index') }}">Home</a>
            </li>

            {# Optional: show vendor management if a vendor is logged in #}
            {% if session.get('user') and session['user'].get('role') == 'vendor' %}
            <li class="nav-item">
              <a class="nav-link {% if active_page=='vendor_gallery' %}active{% endif %}"
                href="{{ url_for('main.vendor_self_view') }}#gallery">Vendor Gallery</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if active_page=='vendor_manage' %}active{% endif %}"
                href="{{ url_for('main.vendor_manage') }}">Vendor Management</a>
            </li>
            {% endif %}

            {% if not user or role == 'customer' %}
            <li class="nav-item">
              <a class="nav-link {% if active_page=='cart' %}active{% endif %}" href="{{ url_for('main.cart') }}">
                <i class="bi bi-cart"></i> Cart
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link {% if active_page=='checkout' %}active{% endif %}"
                href="{{ url_for('main.checkout') }}"><i class="bi bi-credit-card"></i> Checkout</a>
            </li>
            {% endif %}

            {% if not (session.get('user') and session['user'].get('role') == 'vendor' or session.get('user') and
            session['user'].get('role') == 'customer' or session.get('user') and session['user'].get('role') == 'admin')
            %}
            <li class="nav-item">
              <a class="nav-link {% if active_page=='login' %}active{% endif %}"
                href="{{ url_for('main.login') }}">Login</a>
            </li>
            {% endif %}
            {% if session.get('user') and session['user'].get('role') == 'vendor' or session.get('user') and
            session['user'].get('role') == 'customer' or session.get('user') and session['user'].get('role') == 'admin'
            %}
            <li class="nav-item">
              <a class="nav-link {% if active_page=='logout' %}active{% endif %}"
                href="{{ url_for('main.logout') }}">Logout</a>
            </li>
            {% endif %}

          </ul>

          <form class="d-flex" role="search" action="#" method="get">
            <label for="siteSearch" class="visually-hidden">Search site</label>
            <input id="siteSearch" class="form-control me-2" type="search" placeholder="Search">
            <button class="btn btn-outline-light" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>
  </header>

  <main class="container my-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="toast-container position-fixed top-0 end-0 p-4 toast-floating" style="z-index: 1100;">
      {% for category, msg in messages %}
      {% set normalized = 'success' if category in ['success', 'message', None] else category %}
      {% set toast_class = 'text-bg-success' if normalized == 'success' else 'text-bg-primary' %}
      {% if normalized != 'success' and normalized in ['info', 'warning', 'error'] %}
      {% set toast_class = {
      'info': 'text-bg-info',
      'warning': 'text-bg-warning',
      'error': 'text-bg-danger'
      }[normalized] %}
      {% endif %}
      <div class="toast align-items-center {{ toast_class }} border-0 shadow-lg toast-roomy" role="status"
        aria-live="assertive" aria-atomic="true">
        <div class="toast-body d-flex align-items-start gap-3">
          <div class="flex-grow-1">
            <h6 class="fw-semibold mb-1">Notification</h6>
            <p class="mb-0">{{ msg }}</p>
          </div>
          <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="toast"
            aria-label="Close"></button>
        </div>
      </div>
      {% endfor %}
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.bootstrap && bootstrap.Toast) {
          document.querySelectorAll('.toast').forEach((toastEl) => {
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
          });
        }
      });
    </script>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <footer class="footer__colour text-center">
    <p class="py-3 card-text">2025 <i class="bi bi-c-circle small__text"></i> Developed for QUT IFN582</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>
  {% block extra_scripts %}{% endblock %}
</body>

</html>